import{c as L,u as O,b as M,r as i,f as T,d as z,z as d,j as e,L as k,g as p,s as J}from"./index-BCqjIhcd.js";import{S as Q}from"./SEO-CKpWeq1n.js";const G=()=>{const{id:c}=L(),{addToCart:S,cartItems:_}=O(),{addToWishlist:C,removeFromWishlist:$,isInWishlist:u,wishlistItems:R}=M(),[t,A]=i.useState(null),[I,g]=i.useState(!0),[f,P]=i.useState(0),[n,b]=i.useState(1),[m,F]=i.useState([]),[l,x]=i.useState({user_name:"",user_email:"",rating:5,comment:""}),[j,y]=i.useState(!1),v=_.find(s=>s.id===parseInt(c)),h=v?v.quantity:0,o=t&&h>=t.stock,W=()=>{if(o){d.error("You have reached the stock limit for this item in your cart.");return}S(t,n)};i.useEffect(()=>{g(!0),Promise.allSettled([T(c),z(c)]).then(([s,a])=>{const r=s.status==="fulfilled"?s.value:null,E=a.status==="fulfilled"?a.value:[];if(r){if(typeof r.images=="string")try{r.images=JSON.parse(r.images)}catch{r.images=[]}if(Array.isArray(r.images)||(r.images=[]),typeof r.details=="string")try{r.details=JSON.parse(r.details)}catch{r.details=[]}if(typeof r.story=="string")try{r.story=JSON.parse(r.story)}catch{r.story=null}A(r)}else s.status==="rejected"&&console.error("Product fetch failed:",s.reason),d.error("Failed to load product details");a.status==="rejected"&&console.error("Reviews fetch failed:",a.reason),F(E),g(!1)})},[c]);const N=s=>{const a=parseInt(s)||1;if(t&&h+a>t.stock){d.error(`Only ${t.stock-h} more items can be added.`),b(Math.max(1,t.stock-h));return}b(a)};if(I)return e.jsx("div",{className:"flex justify-center py-20",children:e.jsx("div",{className:"w-12 h-12 border-4 border-primary border-t-transparent rounded-full animate-spin"})});if(!t)return e.jsx("div",{className:"text-center py-20 text-xl font-bold",children:"Product not found"});const q=async()=>{if(u(t.id)){const s=R.find(a=>a.product_id===t.id);s&&(await $(s.id),d.success("Removed from wishlist"))}else await C(t.id)&&d.success("Added to wishlist")},D=async s=>{if(s.preventDefault(),!l.user_name||!l.comment){d.error("Please fill in name and comment");return}y(!0);try{await J({...l,product_id:c}),d.success("Review submitted! It will appear after admin approval."),x({user_name:"",user_email:"",rating:5,comment:""})}catch{d.error("Failed to submit review")}finally{y(!1)}};return m.length>0?(m.reduce((s,a)=>s+a.rating,0)/m.length).toFixed(1):t.rating,e.jsxs("div",{className:"max-w-[1280px] mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsx(Q,{title:`${t.name} - ${t.category} | EARG Shop`,description:t.description.substring(0,160),keywords:`${t.name}, ${t.category}, fair trade, charity shop, EARG`}),e.jsxs("div",{className:"mb-8 flex flex-wrap items-center gap-2 text-sm text-slate-500 dark:text-slate-400",children:[e.jsx(k,{to:"/shop",className:"hover:text-primary hover:underline",children:"Shop"}),e.jsx("span",{className:"material-symbols-outlined text-[16px]",children:"chevron_right"}),e.jsx(k,{to:"/shop",className:"hover:text-primary hover:underline",children:t.category}),e.jsx("span",{className:"material-symbols-outlined text-[16px]",children:"chevron_right"}),e.jsx("span",{className:"font-medium text-slate-900 dark:text-slate-200",children:t.name})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-12 xl:gap-16",children:[e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"aspect-square w-full overflow-hidden rounded-xl bg-slate-100 dark:bg-slate-800 relative group",children:[e.jsx("div",{className:"absolute top-4 left-4 z-10 bg-secondary text-white text-xs font-bold px-3 py-1 rounded-full shadow-sm",children:"Fair Trade"}),e.jsx("img",{alt:`${t.name} - Main view`,className:"h-full w-full object-cover object-center transition-transform duration-500 group-hover:scale-105",src:p(t.images[f]),loading:"eager"})]}),e.jsx("div",{className:"grid grid-cols-4 gap-4",children:t.images.map((s,a)=>e.jsx("button",{onClick:()=>P(a),className:`aspect-square overflow-hidden rounded-lg border-2 ${f===a?"border-primary ring-offset-2":"border-transparent"} hover:border-slate-300 transition-colors`,children:e.jsx("img",{alt:`View ${a+1}`,className:"h-full w-full rounded-md object-cover",src:p(s)})},a))})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-semibold text-primary uppercase tracking-wider",children:"Artisan Collection"}),e.jsxs("div",{className:"flex items-center gap-1 text-amber-400 text-sm",children:[[...Array(5)].map((s,a)=>e.jsx("span",{className:`material-symbols-outlined text-[18px] fill-current ${a<Math.floor(t.rating)?"":"text-gray-300"}`,children:"star"},a)),e.jsxs("span",{className:"ml-1 text-slate-500 dark:text-slate-400",children:["(",t.reviews," reviews)"]})]})]}),e.jsx("h1",{className:"text-3xl sm:text-4xl font-bold text-slate-900 dark:text-white leading-tight mb-4",children:t.name}),e.jsx("div",{className:"flex items-end gap-3",children:e.jsxs("span",{className:"text-3xl font-bold text-slate-900 dark:text-white",children:["$",parseFloat(t.price).toFixed(2)]})})]}),e.jsxs("div",{className:"mb-8 rounded-xl bg-secondary/10 border border-secondary/20 p-4 flex items-start gap-4",children:[e.jsx("div",{className:"flex h-10 w-10 shrink-0 items-center justify-center rounded-full bg-secondary text-white",children:e.jsx("span",{className:"material-symbols-outlined",children:"volunteer_activism"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-slate-900 dark:text-white text-sm mb-1",children:"Impact Purchase"}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-300",children:t.impact})]})]}),e.jsx("p",{className:"mb-8 text-base leading-relaxed text-slate-600 dark:text-slate-300",children:t.description}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 mb-10 border-b border-slate-200 dark:border-slate-700 pb-10",children:[e.jsxs("div",{className:"flex h-12 w-32 items-center rounded-lg border border-slate-300 dark:border-slate-600 bg-surface-light dark:bg-surface-dark bg-white dark:bg-gray-800",children:[e.jsx("button",{onClick:()=>b(Math.max(1,n-1)),disabled:n<=1,className:"flex h-full w-10 items-center justify-center text-slate-600 hover:text-primary dark:text-slate-400 disabled:opacity-30",children:e.jsx("span",{className:"material-symbols-outlined text-sm",children:"remove"})}),e.jsx("input",{className:"h-full w-full border-none bg-transparent text-center font-medium text-slate-900 dark:text-white focus:ring-0",type:"number",value:n,onChange:s=>N(s.target.value)}),e.jsx("button",{onClick:()=>N(n+1),disabled:t&&h+n>=t.stock,className:"flex h-full w-10 items-center justify-center text-slate-600 hover:text-primary dark:text-slate-400 disabled:opacity-30",children:e.jsx("span",{className:"material-symbols-outlined text-sm",children:"add"})})]}),e.jsxs("button",{onClick:W,disabled:o,className:`flex-1 h-12 ${o?"bg-gray-400 cursor-not-allowed":"bg-primary hover:bg-primary-dark"} text-white font-bold rounded-lg transition-colors flex items-center justify-center gap-2 shadow-lg ${!o&&"shadow-primary/20"}`,children:[e.jsx("span",{className:"material-symbols-outlined",children:o?"block":"shopping_cart"}),o?"Stock Limit Reached":"Add to Cart"]}),e.jsx("button",{onClick:q,className:`h-12 w-12 flex items-center justify-center rounded-lg border-2 transition-all ${u(t.id)?"border-red-500 bg-red-50 text-red-500":"border-slate-300 text-slate-400 hover:border-red-400 hover:text-red-400"}`,title:u(t.id)?"Remove from Wishlist":"Add to Wishlist",children:e.jsx("span",{className:`material-symbols-outlined ${u(t.id)?"fill-current":""}`,children:"favorite"})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("details",{className:"group rounded-lg bg-surface-light dark:bg-surface-dark border border-slate-200 dark:border-slate-700 open:ring-1 open:ring-primary/20 bg-white dark:bg-gray-800",children:[e.jsxs("summary",{className:"flex cursor-pointer list-none items-center justify-between p-4 font-medium text-slate-900 dark:text-white group-open:text-primary transition-colors",children:[e.jsx("span",{children:"Product Details"}),e.jsx("span",{className:"material-symbols-outlined transition-transform group-open:rotate-180",children:"expand_more"})]}),e.jsx("div",{className:"border-t border-slate-100 dark:border-slate-700 p-4 text-sm text-slate-600 dark:text-slate-300 leading-relaxed",children:e.jsxs("ul",{className:"list-disc list-inside space-y-1",children:[e.jsxs("li",{children:["Material: ",t.material]}),e.jsxs("li",{children:["Dimensions: ",t.dimensions]}),e.jsxs("li",{children:["Origin: ",t.origin]}),t.details&&t.details.map((s,a)=>e.jsx("li",{children:s},a))]})})]}),t.story&&e.jsxs("details",{className:"group rounded-lg bg-surface-light dark:bg-surface-dark border border-slate-200 dark:border-slate-700 bg-white dark:bg-gray-800",children:[e.jsxs("summary",{className:"flex cursor-pointer list-none items-center justify-between p-4 font-medium text-slate-900 dark:text-white hover:text-primary transition-colors",children:[e.jsx("span",{children:"The Artisan Story"}),e.jsx("span",{className:"material-symbols-outlined transition-transform group-open:rotate-180",children:"expand_more"})]}),e.jsx("div",{className:"border-t border-slate-100 dark:border-slate-700 p-4",children:e.jsxs("div",{className:"flex gap-4 items-start",children:[e.jsx("img",{alt:`Featured Artisan: ${t.story.author}`,className:"w-16 h-16 rounded-full object-cover border-2 border-white shadow-sm",src:p(t.story.image),loading:"lazy"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-300 mb-2",children:t.story.text}),e.jsxs("p",{className:"text-xs font-bold text-slate-900 dark:text-white",children:["â€“ ",t.story.author]})]})]})})]})]})]})]}),e.jsxs("div",{className:"mt-16 max-w-4xl mx-auto",children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-900 dark:text-white mb-8",children:"Customer Reviews"}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl p-6 border border-slate-200 dark:border-slate-700 mb-8",children:[e.jsx("h3",{className:"text-lg font-bold text-slate-900 dark:text-white mb-4",children:"Write a Review"}),e.jsxs("form",{onSubmit:D,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Your Name *"}),e.jsx("input",{type:"text",value:l.user_name,onChange:s=>x({...l,user_name:s.target.value}),className:"w-full p-2 border rounded-lg dark:bg-neutral-900 dark:text-white dark:border-slate-600",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Email (optional)"}),e.jsx("input",{type:"email",value:l.user_email,onChange:s=>x({...l,user_email:s.target.value}),className:"w-full p-2 border rounded-lg dark:bg-neutral-900 dark:text-white dark:border-slate-600"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2",children:"Rating *"}),e.jsx("div",{className:"flex gap-2",children:[1,2,3,4,5].map(s=>e.jsx("button",{type:"button",onClick:()=>x({...l,rating:s}),className:"text-2xl transition-colors",children:e.jsx("span",{className:`material-symbols-outlined ${s<=l.rating?"text-amber-400 fill-current":"text-gray-300"}`,children:"star"})},s))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Your Review *"}),e.jsx("textarea",{value:l.comment,onChange:s=>x({...l,comment:s.target.value}),className:"w-full p-2 border rounded-lg dark:bg-neutral-900 dark:text-white dark:border-slate-600",rows:"4",required:!0})]}),e.jsx("button",{type:"submit",disabled:j,className:"bg-primary text-white px-6 py-2 rounded-lg font-bold hover:bg-primary-dark disabled:bg-gray-400 transition-colors",children:j?"Submitting...":"Submit Review"})]})]}),e.jsx("div",{className:"space-y-4",children:m.length===0?e.jsx("p",{className:"text-center text-slate-500 py-8",children:"No reviews yet. Be the first to review this product!"}):m.map(s=>e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl p-6 border border-slate-200 dark:border-slate-700",children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-bold text-slate-900 dark:text-white",children:s.user_name}),e.jsx("div",{className:"flex gap-1 mt-1",children:[...Array(5)].map((a,r)=>e.jsx("span",{className:`material-symbols-outlined text-[16px] fill-current ${r<s.rating?"text-amber-400":"text-gray-300"}`,children:"star"},r))})]}),e.jsx("span",{className:"text-xs text-slate-400",children:new Date(s.created_at).toLocaleDateString()})]}),e.jsx("p",{className:"text-slate-600 dark:text-slate-300",children:s.comment})]},s.id))})]})]})};export{G as default};
